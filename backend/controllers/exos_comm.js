/**
 * @callback exOS_typDataModelCallback
 * @returns {function()}
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus0DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus1DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus2DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus3DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus4DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus5DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus6DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus7DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus8DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus9DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus10DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus11DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus12DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus13DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusmoveShuttleStatus14DataSetValue
 * @property {boolean} acknowledge 
 * @property {boolean} done 
 * 
 * @typedef {Object} exOS_typstatusDataSetValue
 * @property {boolean} ResetShuttleLayout9Done 
 * @property {boolean} ResetShuttleLayout15Done 
 * @property {exOS_typstatusmoveShuttleStatus0DataSetValue} moveShuttleStatus0 
 * @property {exOS_typstatusmoveShuttleStatus1DataSetValue} moveShuttleStatus1 
 * @property {exOS_typstatusmoveShuttleStatus2DataSetValue} moveShuttleStatus2 
 * @property {exOS_typstatusmoveShuttleStatus3DataSetValue} moveShuttleStatus3 
 * @property {exOS_typstatusmoveShuttleStatus4DataSetValue} moveShuttleStatus4 
 * @property {exOS_typstatusmoveShuttleStatus5DataSetValue} moveShuttleStatus5 
 * @property {exOS_typstatusmoveShuttleStatus6DataSetValue} moveShuttleStatus6 
 * @property {exOS_typstatusmoveShuttleStatus7DataSetValue} moveShuttleStatus7 
 * @property {exOS_typstatusmoveShuttleStatus8DataSetValue} moveShuttleStatus8 
 * @property {exOS_typstatusmoveShuttleStatus9DataSetValue} moveShuttleStatus9 
 * @property {exOS_typstatusmoveShuttleStatus10DataSetValue} moveShuttleStatus10 
 * @property {exOS_typstatusmoveShuttleStatus11DataSetValue} moveShuttleStatus11 
 * @property {exOS_typstatusmoveShuttleStatus12DataSetValue} moveShuttleStatus12 
 * @property {exOS_typstatusmoveShuttleStatus13DataSetValue} moveShuttleStatus13 
 * @property {exOS_typstatusmoveShuttleStatus14DataSetValue} moveShuttleStatus14 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle0PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle0DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle0PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle1PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle1DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle1PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle2PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle2DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle2PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle3PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle3DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle3PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle4PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle4DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle4PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle5PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle5DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle5PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle6PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle6DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle6PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle7PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle7DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle7PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle8PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle8DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle8PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle9PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle9DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle9PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle10PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle10DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle10PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle11PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle11DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle11PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle12PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle12DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle12PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle13PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle13DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle13PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle14PositionDataSetValue
 * @property {number} xPos 
 * @property {number} yPos 
 * 
 * @typedef {Object} exOS_typcmdMoveShuttle14DataSetValue
 * @property {boolean} Execute 
 * @property {exOS_typcmdMoveShuttle14PositionDataSetValue} Position 
 * 
 * @typedef {Object} exOS_typcmdDataSetValue
 * @property {exOS_typcmdMoveShuttle0DataSetValue} MoveShuttle0 
 * @property {exOS_typcmdMoveShuttle1DataSetValue} MoveShuttle1 
 * @property {exOS_typcmdMoveShuttle2DataSetValue} MoveShuttle2 
 * @property {exOS_typcmdMoveShuttle3DataSetValue} MoveShuttle3 
 * @property {exOS_typcmdMoveShuttle4DataSetValue} MoveShuttle4 
 * @property {exOS_typcmdMoveShuttle5DataSetValue} MoveShuttle5 
 * @property {exOS_typcmdMoveShuttle6DataSetValue} MoveShuttle6 
 * @property {exOS_typcmdMoveShuttle7DataSetValue} MoveShuttle7 
 * @property {exOS_typcmdMoveShuttle8DataSetValue} MoveShuttle8 
 * @property {exOS_typcmdMoveShuttle9DataSetValue} MoveShuttle9 
 * @property {exOS_typcmdMoveShuttle10DataSetValue} MoveShuttle10 
 * @property {exOS_typcmdMoveShuttle11DataSetValue} MoveShuttle11 
 * @property {exOS_typcmdMoveShuttle12DataSetValue} MoveShuttle12 
 * @property {exOS_typcmdMoveShuttle13DataSetValue} MoveShuttle13 
 * @property {exOS_typcmdMoveShuttle14DataSetValue} MoveShuttle14 
 * @property {boolean} ResetShuttleLayout9 
 * @property {boolean} ResetShuttleLayout15 
 * 
 * @typedef {Object} statusDataSet
 * @property {exOS_typstatusDataSetValue} value 
 * @property {exOS_typDataModelCallback} onChange event fired when `value` changes
 * @property {number} nettime used in the `onChange` event: nettime @ time of publish
 * @property {number} latency used in the `onChange` event: time in us between publish and arrival
 * @property {exOS_typDataModelCallback} onConnectionChange event fired when `connectionState` changes 
 * @property {string} connectionState `Connected`|`Operational`|`Disconnected`|`Aborted` - used in the `onConnectionChange` event
 * 
 * @typedef {Object} cmdDataSet
 * @property {exOS_typcmdDataSetValue} value 
 * @property {function()} publish publish the value
 * @property {exOS_typDataModelCallback} onConnectionChange event fired when `connectionState` changes 
 * @property {string} connectionState `Connected`|`Operational`|`Disconnected`|`Aborted` - used in the `onConnectionChange` event
 * 
 * @typedef {Object} exOS_typDatamodel
 * @property {statusDataSet} status
 * @property {cmdDataSet} cmd
 * 
 * @callback exOS_typDatamodelLogMethod
 * @param {string} message
 * 
 * @typedef {Object} exOS_typDatamodelLog
 * @property {exOS_typDatamodelLogMethod} warning
 * @property {exOS_typDatamodelLogMethod} success
 * @property {exOS_typDatamodelLogMethod} info
 * @property {exOS_typDatamodelLogMethod} debug
 * @property {exOS_typDatamodelLogMethod} verbose
 * 
 * @typedef {Object} exOS_typ
 * @property {function():number} nettime get current nettime
 * @property {exOS_typDataModelCallback} onConnectionChange event fired when `connectionState` changes 
 * @property {string} connectionState `Connected`|`Operational`|`Disconnected`|`Aborted` - used in the `onConnectionChange` event
 * @property {boolean} isConnected
 * @property {boolean} isOperational
 * @property {exOS_typDatamodelLog} log
 * @property {exOS_typDatamodel} datamodel
 * 
 */

/**
 * @type {exOS_typ}
 */
// let exos_typ = require('../../exos_typ/l_exOS_typ.node').exOS_typ;
let exos_typ = require('../l_exOS_typ.node').exOS_typ;
const ERRORS = require('../enum/errors.json');
const setTimeoutP = require('timers/promises').setTimeout;
const _ = require('lodash');


/* datamodel features:

main methods:
    exos_typ.nettime() : (int32_t) get current nettime

state change events:
    exos_typ.onConnectionChange(() => {
        exos_typ.connectionState : (string) "Connected", "Operational", "Disconnected" or "Aborted" 
    })

boolean values:
    exos_typ.isConnected
    exos_typ.isOperational

logging methods:
    exos_typ.log.error(string)
    exos_typ.log.warning(string)
    exos_typ.log.success(string)
    exos_typ.log.info(string)
    exos_typ.log.debug(string)
    exos_typ.log.verbose(string)

dataset status:
    exos_typ.datamodel.status.value : (exOS_status_typ)  actual dataset values
    exos_typ.datamodel.status.onChange(() => {
        exos_typ.datamodel.status.value ...
        exos_typ.datamodel.status.nettime : (int32_t) nettime @ time of publish
        exos_typ.datamodel.status.latency : (int32_t) time in us between publish and arrival
    })
    exos_typ.datamodel.status.onConnectionChange(() => {
        exos_typ.datamodel.status.connectionState : (string) "Connected", "Operational", "Disconnected" or "Aborted"
    });

dataset cmd:
    exos_typ.datamodel.cmd.value : (exOS_cmd_typ)  actual dataset values
    exos_typ.datamodel.cmd.publish()
    exos_typ.datamodel.cmd.onConnectionChange(() => {
        exos_typ.datamodel.cmd.connectionState : (string) "Connected", "Operational", "Disconnected" or "Aborted"
    });
*/

//connection state changes
exos_typ.onConnectionChange(() => {
    switch (exos_typ.connectionState) {
    case "Connected":
        break;
    case "Operational":
        break;
    case "Disconnected":
        break;
    case "Aborted":
        break;
    }
});
exos_typ.datamodel.status.onConnectionChange(() => {
    console.log('stat', exos_typ.datamodel.status.connectionState)
});
exos_typ.datamodel.cmd.onConnectionChange(() => {
    console.log('cmd', exos_typ.datamodel.cmd.connectionState);
    reset_everything();
});

reset_everything = () => {
    if (exos_typ.datamodel.cmd.connectionState === 'Connected') {
        console.log('Resetting Execute flag at start') 
        exos_typ.datamodel.cmd.value.MoveShuttle0.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle1.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle2.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle3.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle4.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle5.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle6.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle7.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle8.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle9.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle10.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle11.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle12.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle13.Execute = false;
        exos_typ.datamodel.cmd.value.MoveShuttle14.Execute = false;
        exos_typ.datamodel.cmd.publish();
    }
}

//value change events
exos_typ.datamodel.status.onChange(() => {
    // console.log('status change', exos_typ.datamodel.status.value);
    if (exos_typ.isConnected) {
        if (exos_typ.datamodel.status.value.moveShutteStatus0.done && exos_typ.datamodel.cmd.value.MoveShuttle0.Execute) {
            MoveShuttle0Resolve();
            console.log('resolve move shuttle 0')
            exos_typ.datamodel.cmd.value.MoveShuttle0.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus1.done && exos_typ.datamodel.cmd.value.MoveShuttle1.Execute) {
            MoveShuttle1Resolve();
            console.log('resolve move shuttle 1')
            exos_typ.datamodel.cmd.value.MoveShuttle1.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus2.done && exos_typ.datamodel.cmd.value.MoveShuttle2.Execute) {
            MoveShuttle2Resolve();
            console.log('resolve move shuttle 2')
            exos_typ.datamodel.cmd.value.MoveShuttle2.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus3.done && exos_typ.datamodel.cmd.value.MoveShuttle3.Execute) {
            MoveShuttle3Resolve();
            console.log('resolve move shuttle 3')
            exos_typ.datamodel.cmd.value.MoveShuttle3.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus4.done && exos_typ.datamodel.cmd.value.MoveShuttle4.Execute) {
            MoveShuttle4Resolve();
            console.log('resolve move shuttle 4')
            exos_typ.datamodel.cmd.value.MoveShuttle4.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus5.done && exos_typ.datamodel.cmd.value.MoveShuttle5.Execute) {
            MoveShuttle5Resolve();
            console.log('resolve move shuttle 5')
            exos_typ.datamodel.cmd.value.MoveShuttle5.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus6.done && exos_typ.datamodel.cmd.value.MoveShuttle6.Execute) {
            MoveShuttle6Resolve();
            console.log('resolve move shuttle 6')
            exos_typ.datamodel.cmd.value.MoveShuttle6.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus7.done && exos_typ.datamodel.cmd.value.MoveShuttle7.Execute) {
            MoveShuttle7Resolve();
            console.log('resolve move shuttle 7')
            exos_typ.datamodel.cmd.value.MoveShuttle7.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus8.done && exos_typ.datamodel.cmd.value.MoveShuttle8.Execute) {
            MoveShuttle8Resolve();
            console.log('resolve move shuttle 8')
            exos_typ.datamodel.cmd.value.MoveShuttle8.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus9.done && exos_typ.datamodel.cmd.value.MoveShuttle9.Execute) {
            MoveShuttle9Resolve();
            console.log('resolve move shuttle 9')
            exos_typ.datamodel.cmd.value.MoveShuttle9.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus10.done && exos_typ.datamodel.cmd.value.MoveShuttle10.Execute) {
            MoveShuttle10Resolve();
            console.log('resolve move shuttle 10')
            exos_typ.datamodel.cmd.value.MoveShuttle10.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus11.done && exos_typ.datamodel.cmd.value.MoveShuttle11.Execute) {
            MoveShuttle11Resolve();
            console.log('resolve move shuttle 11')
            exos_typ.datamodel.cmd.value.MoveShuttle11.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus12.done && exos_typ.datamodel.cmd.value.MoveShuttle12.Execute) {
            MoveShuttle12Resolve();
            console.log('resolve move shuttle 12')
            exos_typ.datamodel.cmd.value.MoveShuttle12.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus13.done && exos_typ.datamodel.cmd.value.MoveShuttle13.Execute) {
            MoveShuttle13Resolve();
            console.log('resolve move shuttle 13')
            exos_typ.datamodel.cmd.value.MoveShuttle13.Execute = false;
        }
        if (exos_typ.datamodel.status.value.moveShutteStatus14.done && exos_typ.datamodel.cmd.value.MoveShuttle14.Execute) {
            MoveShuttle14Resolve();
            console.log('resolve move shuttle 14')
            exos_typ.datamodel.cmd.value.MoveShuttle14.Execute = false;
        }
        exos_typ.datamodel.cmd.publish();
    }
});



MoveShuttle0Resolve = () => {};
MoveShuttle0Reject = () => {};
MoveShuttle1Resolve = () => {};
MoveShuttle1Reject = () => {};
MoveShuttle2Resolve = () => {};
MoveShuttle2Reject = () => {};
MoveShuttle3Resolve = () => {};
MoveShuttle3Reject = () => {};
MoveShuttle4Resolve = () => {};
MoveShuttle4Reject = () => {};
MoveShuttle5Resolve = () => {};
MoveShuttle5Reject = () => {};
MoveShuttle6Resolve = () => {};
MoveShuttle6Reject = () => {};
MoveShuttle7Resolve = () => {};
MoveShuttle7Reject = () => {};
MoveShuttle8Resolve = () => {};
MoveShuttle8Reject = () => {};
MoveShuttle9Resolve = () => {};
MoveShuttle9Reject = () => {};
MoveShuttle10Resolve = () => {};
MoveShuttle10Reject = () => {};
MoveShuttle11Resolve = () => {};
MoveShuttle11Reject = () => {};
MoveShuttle12Resolve = () => {};
MoveShuttle12Reject = () => {};
MoveShuttle13Resolve = () => {};
MoveShuttle13Reject = () => {};
MoveShuttle14Resolve = () => {};
MoveShuttle14Reject = () => {};

ResolveReset = () => {};

let send = false;
exos_typ.onProcessed(() => {
    //Publish values
    // console.log(exos_typ.isConnected ? 'connected' : 'not connected', exos_typ.connectionState); 
    if (exos_typ.isConnected) {
        // if (!send) {
        //     exos_typ.datamodel.cmd.value.MoveShuttle0.acknowledge = true;
        //     exos_typ.datamodel.cmd.value.MoveShuttle0.Position.xPos = 4;
        //     exos_typ.datamodel.cmd.value.MoveShuttle0.Position.yPos = 5;
        //     exos_typ.datamodel.cmd.publish();
        //     send = false;
        // }
    }
});

//connection state changes
/**
 * 
 */
module.exports = class ExOSComm {

    constructor () {
        console.log('exos_comm started')
        // this.onProcessed = exos_typ.onProcessed;
        // this.onConnectionChange = exos_typ.onConnectionChange;
        // this.statusConnChanged = exos_typ.datamodel.status.onConnectionChange;
        // this.cmdConnChanged = exos_typ.datamodel.cmd.onConnectionChange;
        // this.statusChanged = exos_typ.datamodel.status.onChange;
        this.send = false;
        this.promises = {};
        
        this._throttledSendData = _.throttle(this._sendData, 5)
    }

    onProcessed = () => {
        console.log('connected'); 
        if (exos_typ.isConnected) {
            // if (this.send) {
            //     exos_typ.datamodel.cmd.publish();
            //     this.send = false;
            // }
        }
    };

    onConnectionChange = () => {
        switch (exos_typ.connectionState) {
        case "Connected":
            break;
        case "Operational":
            break;
        case "Disconnected":
            break;
        case "Aborted":
            break;
        }
    };

    statusConnChanged = () => {
        console.log('stat', exos_typ.datamodel.status.connectionState)        
    };

    cmdConnChanged = () => {
        console.log('cmd', exos_typ.datamodel.cmd.connectionState)
    };

    statusChanged = () => {
    };

    cmdChanged = () => {
        console.log('cmd change', exos_typ.datamodel.cmd.value);
    };

    resetBoard15 = () => {

    }

    /**
     * 
     * @param {String} shuttleId 
     * @param {Shuttle[]} shuttles 
     * @returns {Promise}
     */
    async setData (shuttleId, shuttles) {
        
        let id = 'MoveShuttle' + shuttleId;
        // console.log('setting new data to exos for shuttle', shuttleId, id);
        let statusId = 'moveShutteStatus' + shuttleId
        // while (exos_typ.datamodel.status.value[statusId].done) {
        //     //Do nothing
        //     if (exos_typ.datamodel.cmd.value[id].Execute) {
        //         exos_typ.datamodel.cmd.value[id].Execute = false;
        //         exos_typ.datamodel.cmd.publish();
        //     }
        //     await setTimeoutP(2000)
        // }

        if (exos_typ.datamodel.cmd.value[id].Execute) throw new Error('Execute command not finished cannot set new movement', { cause: { errorId: ERRORS.STATION_LOCKED, shuttleId: shuttleId }});

        exos_typ.datamodel.cmd.value[id].Position.xPos = shuttles[shuttleId].getPosition().x;
        exos_typ.datamodel.cmd.value[id].Position.yPos = shuttles[shuttleId].getPosition().y;
        exos_typ.datamodel.cmd.value[id].Execute = true;

        this.promises[id] = new Promise(function(resolve, reject) {
            // not taking our time to do the job
            switch (id) {
                case 'MoveShuttle0':
                    MoveShuttle0Resolve = resolve;
                    MoveShuttle0Reject = reject;
                    break;
                
                case 'MoveShuttle1':
                    MoveShuttle1Resolve = resolve;
                    MoveShuttle1Reject = reject;
                    break;
                
                case 'MoveShuttle2':
                    MoveShuttle2Resolve = resolve;
                    MoveShuttle2Reject = reject;
                    break;
                
                case 'MoveShuttle3':
                    MoveShuttle3Resolve = resolve;
                    MoveShuttle3Reject = reject;
                    break;
                
                case 'MoveShuttle4':
                    MoveShuttle4Resolve = resolve;
                    MoveShuttle4Reject = reject;
                    break;
                
                case 'MoveShuttle5':
                    MoveShuttle5Resolve = resolve;
                    MoveShuttle5Reject = reject;
                    break;

                    
                case 'MoveShuttle6':
                    MoveShuttle6Resolve = resolve;
                    MoveShuttle6Reject = reject;
                    break;
                
                case 'MoveShuttle7':
                    MoveShuttle7Resolve = resolve;
                    MoveShuttle7Reject = reject;
                    break;
                    
                case 'MoveShuttle8':
                    MoveShuttle8Resolve = resolve;
                    MoveShuttle8Reject = reject;
                    break;
        
                case 'MoveShuttle9':
                    MoveShuttle9Resolve = resolve;
                    MoveShuttle9Reject = reject;
                    break;
                
                case 'MoveShuttle10':
                    MoveShuttle10Resolve = resolve;
                    MoveShuttle10Reject = reject;
                    break;
    
                case 'MoveShuttle11':
                    MoveShuttle11Resolve = resolve;
                    MoveShuttle11Reject = reject;
                    break;
                
                case 'MoveShuttle12':
                    MoveShuttle12Resolve = resolve;
                    MoveShuttle12Reject = reject;
                    break;

                case 'MoveShuttle13':
                    MoveShuttle13Resolve = resolve;
                    MoveShuttle13Reject = reject;
                    break;
                
                case 'MoveShuttle14':
                    MoveShuttle14Resolve = resolve;
                    MoveShuttle14Reject = reject;
                    break;
            }
        });

        console.log(new Date().toISOString(), 'for shuttle', shuttleId, 'appending data to exos struct', exos_typ.datamodel.cmd.value[id]);
        return this.promises[id];
    }

    sendData () {
        this._throttledSendData();
    }

    _sendData () {
        console.log('publishing data to exos')
        this.send = true;
        exos_typ.datamodel.cmd.publish();

    }
};